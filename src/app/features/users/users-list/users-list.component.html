<div class="users-list-container">
  <div class="section-header">
    <h3>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
    <p class="section-description">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å–∏—Å—Ç–µ–º—ã, –∏—Ö —Ä–æ–ª—è–º–∏ –∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏</p>
  </div>

  <div class="add-user-section">
    <button class="btn btn-primary add-user-btn" (click)="addUser()">
      <span class="btn-icon">üë§</span>
      –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    </button>
  </div>

  <div *ngIf="loading" class="loading-indicator">
    <div class="spinner"></div>
    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</p>
  </div>

  <div *ngIf="error" class="error-message">
    <p>{{ error }}</p>
    <button (click)="loadUsers()" class="btn-retry">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É</button>
  </div>

  <div *ngIf="!loading && !error" class="users-content">
    <div class="users-grid">
      <div class="user-card"
           *ngFor="let user of users"
           [class.selected]="selectedUser?.id === user.id"
           [class.blocked]="user.isBlocked"
           (click)="selectUser(user)">

        <div class="user-info">
          <div class="user-avatar">
            <span class="avatar-text">{{ user.username.charAt(0).toUpperCase() }}</span>
          </div>
          <div class="user-details">
            <h4 class="username">{{ user.username }}</h4>
            <p class="email">{{ user.email }}</p>
            <span class="role-badge" [class]="'role-' + user.role.toLowerCase()">
              {{ user.role }}
            </span>
          </div>
        </div>

        <div class="user-status">
          <span *ngIf="user.isBlocked" class="blocked-status">üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>
          <span *ngIf="!user.isBlocked" class="active-status">‚úÖ –ê–∫—Ç–∏–≤–µ–Ω</span>
        </div>

        <div class="user-actions">
          <button class="action-btn edit-btn"
                  (click)="editUser(user, $event)"
                  title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
            ‚úèÔ∏è
          </button>

          <button class="action-btn reset-password-btn"
                  (click)="resetPassword(user, $event)"
                  title="–°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å">
            üîë
          </button>
          <button class="action-btn block-btn"
                  (click)="toggleUserBlock(user, $event)"
                  [title]="user.isBlocked ? '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' : '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'">
            {{ user.isBlocked ? 'üîì' : 'üö´' }}
          </button>
          <button class="action-btn delete-btn"
                  (click)="deleteUser(user, $event)"
                  title="–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
            üóëÔ∏è
          </button>
        </div>
      </div>
    </div>

    <div *ngIf="users.length === 0" class="no-users">
      <div class="empty-state">
        <div class="empty-icon">üë•</div>
        <h4>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
        <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã —Å —Å–∏—Å—Ç–µ–º–æ–π</p>
      </div>
    </div>
  </div>
</div>

<div *ngIf="showAddUserModal" class="modal-overlay" (click)="closeAddUserModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
      <button class="close-btn" (click)="closeAddUserModal()">&times;</button>
    </div>

    <form [formGroup]="addUserForm" (ngSubmit)="onSubmitAddUser()" class="user-form">
      <div class="form-group">
        <label for="addUsername">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è *</label>
        <input
          id="addUsername"
          type="text"
          formControlName="username"
          class="form-control"
          [class.invalid]="addUsernameField?.invalid && addUsernameField?.touched"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
        <div *ngIf="addUsernameField?.invalid && addUsernameField?.touched" class="error-message">
          <span *ngIf="addUsernameField?.errors?.['required']">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</span>
          <span *ngIf="addUsernameField?.errors?.['minlength']">–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞</span>
        </div>
      </div>

      <div class="form-group">
        <label for="addEmail">Email *</label>
        <input
          id="addEmail"
          type="email"
          formControlName="email"
          class="form-control"
          [class.invalid]="addEmailField?.invalid && addEmailField?.touched"
          placeholder="–í–≤–µ–¥–∏—Ç–µ email">
        <div *ngIf="addEmailField?.invalid && addEmailField?.touched" class="error-message">
          <span *ngIf="addEmailField?.errors?.['required']">Email –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω</span>
          <span *ngIf="addEmailField?.errors?.['email']">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email</span>
        </div>
      </div>

      <div class="form-group">
        <label for="addPassword">–ü–∞—Ä–æ–ª—å *</label>
        <input
          id="addPassword"
          type="password"
          formControlName="password"
          class="form-control"
          [class.invalid]="addPasswordField?.invalid && addPasswordField?.touched"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
        <div *ngIf="addPasswordField?.invalid && addPasswordField?.touched" class="error-message">
          <span *ngIf="addPasswordField?.errors?.['required']">–ü–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω</span>
          <span *ngIf="addPasswordField?.errors?.['minlength']">–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤</span>
        </div>
      </div>

      <div class="form-group">
        <label for="addRole">–†–æ–ª—å *</label>
        <select
          id="addRole"
          formControlName="role"
          class="form-control">
          <option *ngFor="let role of userRoles" [value]="role">{{ role }}</option>
        </select>
      </div>

      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" formControlName="isBlocked">
          <span class="checkmark"></span>
          –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
        </label>
      </div>

      <div class="form-actions">
        <button type="button"
                class="btn btn-secondary"
                (click)="closeAddUserModal()"
                [disabled]="isAddingUser">
          –û—Ç–º–µ–Ω–∞
        </button>
        <button type="submit"
                class="btn btn-primary"
                [disabled]="addUserForm.invalid || isAddingUser">
          <span *ngIf="!isAddingUser">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
          <span *ngIf="isAddingUser">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ...</span>
        </button>
      </div>
    </form>
  </div>
</div>

<div *ngIf="showEditUserModal" class="modal-overlay" (click)="closeEditUserModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
      <button class="close-btn" (click)="closeEditUserModal()">&times;</button>
    </div>

    <form [formGroup]="editUserForm" (ngSubmit)="onSubmitEditUser()" class="user-form">
      <div class="form-group">
        <label for="editUsername">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è *</label>
        <input
          id="editUsername"
          type="text"
          formControlName="username"
          class="form-control"
          [class.invalid]="editUsernameField?.invalid && editUsernameField?.touched"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
        <div *ngIf="editUsernameField?.invalid && editUsernameField?.touched" class="error-message">
          <span *ngIf="editUsernameField?.errors?.['required']">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</span>
          <span *ngIf="editUsernameField?.errors?.['minlength']">–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞</span>
        </div>
      </div>

      <div class="form-group">
        <label for="editEmail">Email *</label>
        <input
          id="editEmail"
          type="email"
          formControlName="email"
          class="form-control"
          [class.invalid]="editEmailField?.invalid && editEmailField?.touched"
          placeholder="–í–≤–µ–¥–∏—Ç–µ email">
        <div *ngIf="editEmailField?.invalid && editEmailField?.touched" class="error-message">
          <span *ngIf="editEmailField?.errors?.['required']">Email –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω</span>
          <span *ngIf="editEmailField?.errors?.['email']">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email</span>
        </div>
      </div>

      <div class="form-group">
        <label for="editRole">–†–æ–ª—å *</label>
        <select
          id="editRole"
          formControlName="role"
          class="form-control">
          <option *ngFor="let role of userRoles" [value]="role">{{ role }}</option>
        </select>
      </div>

      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" formControlName="isBlocked">
          <span class="checkmark"></span>
          –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
        </label>
      </div>

      <div class="form-actions">
        <button type="button"
                class="btn btn-secondary"
                (click)="closeEditUserModal()"
                [disabled]="isEditingUser">
          –û—Ç–º–µ–Ω–∞
        </button>
        <button type="submit"
                class="btn btn-primary"
                [disabled]="editUserForm.invalid || isEditingUser">
          <span *ngIf="!isEditingUser">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</span>
          <span *ngIf="isEditingUser">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...</span>
        </button>
      </div>
    </form>
  </div>
</div>


