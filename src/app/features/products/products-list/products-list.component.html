<div class="products-list-container">
  <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
  <div class="control-panel">
    <form [formGroup]="searchForm" class="search-section">
      <input
        type="text"
        placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –ø—Ä–æ–¥—É–∫—Ç–∞..."
        class="search-input"
        formControlName="search">
      <select class="category-select" formControlName="category">
        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
        <option *ngFor="let category of categories" [value]="category">
          {{ category }}
        </option>
      </select>
    </form>

    <div class="action-buttons">
      <button class="btn btn-add-product" (click)="addProduct()">
        ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç
      </button>
      <button class="btn btn-add-category" *ngIf="currentUser?.role !== 'Simple'" (click)="addCategory()">
        Ô∏è –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
      </button>
    </div>
  </div>

  <div *ngIf="isLoading" class="loading-indicator">
    <div class="spinner"></div>
    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤...</p>
  </div>

  <div *ngIf="error" class="error-message">
    <p>{{ error }}</p>
    <button class="btn btn-retry" (click)="loadProducts()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
  </div>

  <div class="table-container" *ngIf="!isLoading && !error">
    <div class="table-header">
      <h3>–ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤: {{ filteredProducts.length }}</h3>
    </div>

    <table class="products-table" *ngIf="filteredProducts.length > 0">
      <thead>
        <tr>
          <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞</th>
          <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
          <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
          <th>–°—Ç–æ–∏–º–æ—Å—Ç—å –≤ —Ä—É–±–ª—è—Ö</th>
          <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –æ–±—â–µ–µ</th>
          <th *ngIf="currentUser?.role !== 'Simple'">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ</th>
          <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of filteredProducts"
            (click)="viewProduct(product)"
            [class.selected]="selectedProduct?.id === product.id">
          <td>{{ product.name }}</td>
          <td>{{ product.category }}</td>
          <td>{{ product.description }}</td>
          <td>{{ product.price | formatPrice }}</td>
          <td>{{ product.noteGeneral || '-' }}</td>
          <td *ngIf="currentUser?.role !== 'Simple'">{{ product.noteSpecial || '-' }}</td>
          <td>
            <button class="btn-edit" (click)="editProduct(product); $event.stopPropagation()">‚úèÔ∏è</button>
            <button class="btn-delete" *ngIf="currentUser?.role !== 'Simple'" (click)="deleteProduct(product); $event.stopPropagation()">üóëÔ∏è</button>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="filteredProducts.length === 0 && !isLoading" class="no-products">
      <p>–ü—Ä–æ–¥—É–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
    </div>
  </div>
</div>

<div class="modal-overlay" *ngIf="showViewProductModal" (click)="closeViewProductModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>–ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–¥—É–∫—Ç–∞</h3>
      <button class="modal-close" (click)="closeViewProductModal()">√ó</button>
    </div>

    <div class="view-product-form" *ngIf="selectedProduct">
      <div class="form-group">
        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞</label>
        <div class="view-field">{{ selectedProduct.name }}</div>
      </div>

      <div class="form-group">
        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <div class="view-field">{{ selectedProduct.category }}</div>
      </div>

      <div class="form-group">
        <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
        <div class="view-field">{{ selectedProduct.description }}</div>
      </div>

      <div class="form-group">
        <label>–°—Ç–æ–∏–º–æ—Å—Ç—å –≤ —Ä—É–±–ª—è—Ö</label>
        <div class="view-field">{{ selectedProduct.price | formatPrice }}</div>
      </div>

      <div class="form-group">
        <label>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –æ–±—â–µ–µ</label>
        <div class="view-field">{{ selectedProduct.noteGeneral || '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</div>
      </div>

      <div class="form-group" *ngIf="currentUser?.role !== 'Simple'">
        <label>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ</label>
        <div class="view-field">{{ selectedProduct.noteSpecial || '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-close" (click)="closeViewProductModal()">
          –ó–∞–∫—Ä—ã—Ç—å
        </button>
      </div>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞ -->
<div class="modal-overlay" *ngIf="showAddProductModal" (click)="closeAddProductModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç</h3>
      <button class="modal-close" (click)="closeAddProductModal()">√ó</button>
    </div>

    <form [formGroup]="addProductForm" (ngSubmit)="onSubmitAddProduct()" class="add-product-form">
      <div class="form-group">
        <label for="name">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ *</label>
        <input
          type="text"
          id="name"
          formControlName="name"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞"
          [class.error]="nameField?.invalid && nameField?.touched">
        <div class="error-message" *ngIf="nameField?.invalid && nameField?.touched">
          <span *ngIf="nameField?.errors?.['required']">–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</span>
          <span *ngIf="nameField?.errors?.['minlength']">–ú–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞</span>
        </div>
      </div>

      <div class="form-group">
        <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
        <select id="category" formControlName="category" [class.error]="categoryField?.invalid && categoryField?.touched">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
          <option *ngFor="let category of categories" [value]="category">
            {{ category }}
          </option>
        </select>
        <div class="error-message" *ngIf="categoryField?.invalid && categoryField?.touched">
          <span *ngIf="categoryField?.errors?.['required']">–ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞</span>
        </div>
      </div>

      <div class="form-group">
        <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ *</label>
        <textarea
          id="description"
          formControlName="description"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞"
          rows="3"
          [class.error]="descriptionField?.invalid && descriptionField?.touched"></textarea>
        <div class="error-message" *ngIf="descriptionField?.invalid && descriptionField?.touched">
          <span *ngIf="descriptionField?.errors?.['required']">–û–ø–∏—Å–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</span>
          <span *ngIf="descriptionField?.errors?.['minlength']">–ú–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤</span>
        </div>
      </div>

      <div class="form-group">
        <label for="price">–°—Ç–æ–∏–º–æ—Å—Ç—å –≤ —Ä—É–±–ª—è—Ö *</label>
        <input
          type="text"
          id="price"
          formControlName="price"
          placeholder="0.000"
          [class.error]="priceField?.invalid && priceField?.touched">
        <div class="error-message" *ngIf="priceField?.invalid && priceField?.touched">
          <span *ngIf="priceField?.errors?.['required']">–°—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞</span>
          <span *ngIf="priceField?.errors?.['pattern']">–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ü–µ–Ω—ã</span>
        </div>
      </div>

      <div class="form-group">
        <label for="noteGeneral">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –æ–±—â–µ–µ</label>
        <input
          type="text"
          id="noteGeneral"
          formControlName="noteGeneral"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–±—â–µ–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ">
      </div>

      <div class="form-group" *ngIf="currentUser?.role !== 'Simple'">
        <label for="noteSpecial">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ</label>
        <input
          type="text"
          id="noteSpecial"
          formControlName="noteSpecial"
          placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ">
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-cancel" (click)="closeAddProductModal()">
          –û—Ç–º–µ–Ω–∞
        </button>
        <button type="submit" class="btn btn-submit" [disabled]="isAddingProduct">
          <span *ngIf="!isAddingProduct">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç</span>
          <span *ngIf="isAddingProduct">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ...</span>
        </button>
      </div>
    </form>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
<div class="modal-overlay" *ngIf="showAddCategoryModal" (click)="closeAddCategoryModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
      <button class="modal-close" (click)="closeAddCategoryModal()">√ó</button>
    </div>

    <form [formGroup]="addCategoryForm" (ngSubmit)="onSubmitAddCategory()" class="add-category-form">
      <div class="form-group">
        <label for="categoryName">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ *</label>
        <input
          type="text"
          id="categoryName"
          formControlName="name"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
          [class.error]="categoryNameField?.invalid && categoryNameField?.touched">
        <div class="error-message" *ngIf="categoryNameField?.invalid && categoryNameField?.touched">
          <span *ngIf="categoryNameField?.errors?.['required']">–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</span>
          <span *ngIf="categoryNameField?.errors?.['minlength']">–ú–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞</span>
        </div>
      </div>

      <div class="form-group">
        <label for="categoryDescription">–û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ *</label>
        <textarea
          id="categoryDescription"
          formControlName="description"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
          rows="3"
          [class.error]="categoryDescriptionField?.invalid && categoryDescriptionField?.touched"></textarea>
        <div class="error-message" *ngIf="categoryDescriptionField?.invalid && categoryDescriptionField?.touched">
          <span *ngIf="categoryDescriptionField?.errors?.['required']">–û–ø–∏—Å–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</span>
          <span *ngIf="categoryDescriptionField?.errors?.['minlength']">–ú–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤</span>
        </div>
      </div>

      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" formControlName="isActive">
          <span class="checkmark"></span>
          –ê–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
        </label>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-cancel" (click)="closeAddCategoryModal()">
          –û—Ç–º–µ–Ω–∞
        </button>
        <button type="submit" class="btn btn-submit" [disabled]="isAddingCategory">
          <span *ngIf="!isAddingCategory">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</span>
          <span *ngIf="isAddingCategory">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ...</span>
        </button>
      </div>
    </form>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞ -->
<div class="modal-overlay" *ngIf="showEditProductModal" (click)="closeEditProductModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç</h3>
      <button class="modal-close" (click)="closeEditProductModal()">√ó</button>
    </div>

    <form [formGroup]="editProductForm" (ngSubmit)="onSubmitEditProduct()" class="edit-product-form">
      <div class="form-group">
        <label for="editName">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ *</label>
        <input
          type="text"
          id="editName"
          formControlName="name"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞"
          [class.error]="editNameField?.invalid && editNameField?.touched">
        <div class="error-message" *ngIf="editNameField?.invalid && editNameField?.touched">
          <span *ngIf="editNameField?.errors?.['required']">–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</span>
          <span *ngIf="editNameField?.errors?.['minlength']">–ú–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞</span>
        </div>
      </div>

      <div class="form-group">
        <label for="editCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
        <select id="editCategory" formControlName="category" [class.error]="editCategoryField?.invalid && editCategoryField?.touched">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
          <option *ngFor="let category of categories" [value]="category">
            {{ category }}
          </option>
        </select>
        <div class="error-message" *ngIf="editCategoryField?.invalid && editCategoryField?.touched">
          <span *ngIf="editCategoryField?.errors?.['required']">–ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞</span>
        </div>
      </div>

      <div class="form-group">
        <label for="editDescription">–û–ø–∏—Å–∞–Ω–∏–µ *</label>
        <textarea
          id="editDescription"
          formControlName="description"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞"
          rows="3"
          [class.error]="editDescriptionField?.invalid && editDescriptionField?.touched"></textarea>
        <div class="error-message" *ngIf="editDescriptionField?.invalid && editDescriptionField?.touched">
          <span *ngIf="editDescriptionField?.errors?.['required']">–û–ø–∏—Å–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</span>
          <span *ngIf="editDescriptionField?.errors?.['minlength']">–ú–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤</span>
        </div>
      </div>

      <div class="form-group">
        <label for="editPrice">–°—Ç–æ–∏–º–æ—Å—Ç—å –≤ —Ä—É–±–ª—è—Ö *</label>
        <input
          type="text"
          id="editPrice"
          formControlName="price"
          placeholder="0.000"
          [class.error]="editPriceField?.invalid && editPriceField?.touched">
        <div class="error-message" *ngIf="editPriceField?.invalid && editPriceField?.touched">
          <span *ngIf="editPriceField?.errors?.['required']">–°—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞</span>
          <span *ngIf="editPriceField?.errors?.['pattern']">–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ü–µ–Ω—ã</span>
        </div>
      </div>

      <div class="form-group">
        <label for="editNoteGeneral">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –æ–±—â–µ–µ</label>
        <input
          type="text"
          id="editNoteGeneral"
          formControlName="noteGeneral"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–±—â–µ–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ">
      </div>

      <div class="form-group" *ngIf="currentUser?.role !== 'Simple'">
        <label for="editNoteSpecial">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ</label>
        <input
          type="text"
          id="editNoteSpecial"
          formControlName="noteSpecial"
          placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ">
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-cancel" (click)="closeEditProductModal()">
          –û—Ç–º–µ–Ω–∞
        </button>
        <button type="submit" class="btn btn-submit" [disabled]="isEditingProduct">
          <span *ngIf="!isEditingProduct">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</span>
          <span *ngIf="isEditingProduct">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...</span>
        </button>
      </div>
    </form>
  </div>
</div>
